<!DOCTYPE html>
<html lang="zh-CN">

<head>

    <!-- æ–°å¢å¼€å§‹ -->
  
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!-- æœ€æ–°ç‰ˆæœ¬çš„ echarts æ ¸å¿ƒ CSS æ–‡ä»¶ -->
    <script src="echarts/echarts.min.js"></script>
    <!-- æœ€æ–°ç‰ˆæœ¬çš„ echarts æ ¸å¿ƒ CSS æ–‡ä»¶ -->
    <script src="js/map/china.js"></script>

    <!-- æ–°å¢åœ°å›¾æˆªæ­¢ -->



    <meta charset="UTF-8">
    <title color="#66c2a5">é£Ÿå“è¥å…»åˆ†æç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ... ä¿ç•™åŸæœ‰æ ·å¼ ... */
        :root {
            /* --primary-color: #4b6cb7;
            --secondary-color: #37c2bb; */
              --primary-color: #66c2a5;
            --secondary-color: #f8f9fa;
        }

        /* body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        } */


        /* æ–°å¢èƒŒæ™¯ */

body {
  /* min-height: 100vh;
  margin: 0;      */
width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  /* position: relative; */
    position: static; /* ç§»é™¤å®šä½ */
  /* overflow: hidden; */
    overflow: auto; /* å…è®¸æ»šåŠ¨ */
  background: #0a192f; /* æ·±æµ·è“åŸºè‰² */

}

/* æ–°å¢åŠ¨æ€èƒŒæ™¯ */
/* åŠ¨æ€æ¸å˜å±‚ */
body::before {
  content: '';
  position: absolute;
  width: 150%;
  height: 150%;
  background: 
    linear-gradient(
      335deg, 
      rgba(16, 84, 147, 0.8) 0%, 
      rgba(92, 167, 228, 0.6) 25%,
      rgba(138, 43, 226, 0.4) 50%,
      rgba(255, 105, 180, 0.2) 100%
    ),
    radial-gradient(
      circle at 70% 30%,
      rgba(255, 215, 0, 0.15) 0%,
      transparent 40%
    );
  animation: gradientFlow 120s ease infinite;
  mix-blend-mode: soft-light;
}

/* æ˜Ÿé™…ç²’å­å±‚ */
body::after {
  content: '';
  position: absolute;
  width: 300%;
  height: 300%;
  background: 
    radial-gradient(circle, 
      rgba(255,255,255,0.9) 6%, 
      transparent 4%
    ),
    radial-gradient(circle, 
      rgba(255,215,0,0.8) 4%, 
      transparent 6%
    );
  background-size: 40px 40px;
   background-position: 10px 10px; /* è°ƒæ•´ç²’å­çš„èµ·å§‹ä½ç½® */
  opacity: 0.3;
  animation: 
    particleMove 60s linear infinite,
    particlePulse 4s ease-in-out infinite;
}
body::before,
body::after {
  transform: translate3d(0,0,0); /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ */
  will-change: transform, opacity; /* æå‰å‘ŠçŸ¥æµè§ˆå™¨ */

  /* è§£å†³äº¤äº’é—®é¢˜ */
    pointer-events: none; /* å…³é”®å±æ€§ï¼šå…è®¸é¼ æ ‡äº‹ä»¶ç©¿é€ */
  z-index: 0; /* æ˜ç¡®è®¾ç½®èƒŒæ™¯å±‚åœ¨åº•å±‚ */
}

@keyframes gradientFlow {
  0%, 100% { 
    transform: rotate(0deg) translate(0, 0);
    filter: hue-rotate(0deg);
  }
  25% { 
    transform: rotate(2deg) translate(-5%, 3%);
  }
  50% { 
    transform: rotate(-1deg) translate(5%, -2%);
  }
  75% { 
    transform: rotate(3deg) translate(-3%, 4%);
  }
}
/* 
@keyframes particleMove {
  from { transform: translate(0,0); }
  to { transform: translate(-50%,-50%); }
} */

@keyframes particleMove {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(20px, -30px) rotate(10deg); }
  50% { transform: translate(-40px, 50px) rotate(-15deg); }
  75% { transform: translate(30px, 20px) rotate(5deg); }
  100% { transform: translate(-20px, -20px) rotate(-10deg); }
}

@keyframes particlePulse {
  0%, 100% { opacity: 0.2; }
  50% { opacity: 0.4; }
}

/* å†…å®¹å®¹å™¨ä¼˜åŒ– */
.content-wrapper {
  position: relative;
  z-index: 1;
  background: rgba(10, 25, 47, 0.7);
  padding: 2rem;
  border-radius: 12px;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(92, 167, 228, 0.3);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}




        /* æ–°å¢æˆªæ­¢ */

        .nav-tabs .nav-link {
            border-radius: 15px 15px 0 0;
            transition: all 0.3s;
            margin: 0 5px;
            border: none;
            color: #66c2a5 !important  ;
        }

        .nav-tabs .nav-link.active {
            background: var(--primary-color);
            color: white !important;
            transform: translateY(-2px);
        }

        .analysis-card {
            /* background: #86b7fe; */
             background: transparent;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
        }

        .chart-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            height: 70vh;
        }

        .search-box {
            max-width: 600px;
            /* margin: 20px auto 2rem; */
              margin: 20px 200px 0px 400px;
            
        }

        .gradient-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
        }




        /* æ–°å¢ */
        .svg-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    /* background: linear-gradient(135deg, #667eea, #764ba2); */
       background: linear-gradient(135deg, #66c2a5, #0a846d);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;


    /* è§£å†³äº¤äº’é—®é¢˜ */
    position: relative;
  z-index: 3; /* é«˜äºåœ°å›¾ */
    
}

.svg-button:hover {
    transform: translateY(-2px) rotate(-5deg);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    background: linear-gradient(135deg, #764ba2, #667eea);
}

.svg-button svg {
    transition: transform 0.3s ease;
}

.svg-button:hover svg {
    transform: translateX(-3px);
}

.svg-button:active {
    transform: translateY(1px);
}
   
.text-primary{
    color:#66c2a5 !important;
}



/* è§£å†³åŠ¨æ€ç”»é¢äº¤äº’é—®é¢˜ */
.nav-item
{
    
  position: relative;
  z-index: 3; /* é«˜äºåœ°å›¾ */
  font-size: 23px;
}


.about-container
{
    position: relative;
    height: 800px;
    width: 100%;
    background-color:#0a846d;
}


/* æ–°å¢åœ°å›¾ */

    .fruit {
            width: 100%;
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
            /* æ ‡é¢˜å’Œå›¾è¡¨ä¹‹é—´çš„é—´è· */
            font-size: 24px;
            color: white;
        }

        .button-container {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        .button-container button {
            margin: 0 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #main {
            width: 1200px;
            height: 1200px;
            margin: auto;
              position: relative;
  z-index: 1; /* ç¡®ä¿é«˜äºèƒŒæ™¯å±‚ */
        }

        /* åœ°å›¾å®¹å™¨ç‰¹æ®Šå¤„ç† */
.echarts-container { 
  position: relative !important;
  z-index: 2 !important;
}
/* æ–°å¢æˆªæ­¢ */

/* æ–°å¢åœ°å›¾2 */

/* æ–°å¢æŒ‰é’®css */

  .button-container {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
             position: relative;
  z-index: 3; /* é«˜äºåœ°å›¾ */
        }
        
        .button-container button {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .button-container button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }



        /* æ”¹å˜å­—ä½“é¢œè‰² */
        .text-start
        {
            color: white;
            font-size: 20px;
        }
        .lead text-muted mb-4
        {
            color: white;
            font-size:20px;
        }

     .mb-4
        {
            color:white;
        }
    .text-center
    {
        color:white;
    }


 
    </style>
</head>

<body>
    <!-- ... ä¿ç•™åŸæœ‰HTMLç»“æ„ ... -->
    <div class="container py-4">
        <!-- å¯¼èˆª -->
        <ul class="nav nav-tabs justify-content-center mb-4" id="myTab">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#home">é¦–é¡µ</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#analysis">è¥å…»åˆ†æ</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#ranking">è¥å…»æ’è¡Œ</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#about">å„åœ°é£Ÿç‰©å¹´äº§é‡å›¾</button>
            </li>
        </ul>
        <!-- <div class="back-to-home">
            <a href="index.html" class="button">è¿”å›çŸ¥è¯†å›¾è°±ç•Œé¢</a>
        </div> -->
        <a href="index.html" class="svg-button" aria-label="è¿”å›"  >
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
            </svg>
        </a>





        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="tab-content">
            <!-- é¦–é¡µ -->
            <div class="tab-pane fade show active" id="home">
                <div class="text-center py-5">
                    <h1 class="display-4 mb-4 text-primary">é£Ÿå“è¥å…»åˆ†æ</h1>
                    <p class="lead text-muted mb-4">å…¨é¢è§£æé£Ÿå“è¥å…»æˆåˆ†ï¼ŒåŠ©æ‚¨ç§‘å­¦ç®¡ç†é¥®é£Ÿ</p>

                    <div class="row g-4 justify-content-center">
                        <div class="col-md-4">
                            <div class="card analysis-card h-100">
                                <div class="card-body">
                                    <h5 class="text-primary">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h5>
                                    <ul class="text-start">
                                        <li>é€‰æ‹©ã€è¥å…»åˆ†æã€‘æŸ¥çœ‹å•å“è¥å…»</li>
                                        <li>é€‰æ‹©ã€è¥å…»æ’è¡Œã€‘æŸ¥çœ‹TOP10</li>
                                        <li>æ”¯æŒæ°´æœ/è”¬èœåˆ†ç±»æŸ¥è¯¢</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¥å…»åˆ†æ -->
            <div class="tab-pane fade" id="analysis">
                <div class="analysis-card p-4 my-4">
                    <h3 class="text-center mb-4">ğŸ é£Ÿå“è¥å…»åˆ†æ</h3>

                    <!-- å•ä½è¯´æ˜ -->
                    <div class="unit-info text-center">
                        <i class="fas fa-info-circle me-2 text-primary"></i>
                        æ‰€æœ‰æ•°å€¼å‡ä»¥æ¯100å…‹å¯é£Ÿç”¨éƒ¨åˆ†è®¡ç®—ï¼š
                        <div class="mt-2">
                            <span class="badge bg-primary me-2">å¡è·¯é‡Œï¼šåƒå¡(kcal)</span>
                            <span class="badge bg-success me-2">ç»´ç”Ÿç´ Aï¼šå›½é™…å•ä½(IU)</span>
                            <span class="badge bg-info">å…¶ä»–æˆåˆ†ï¼šå…‹(g)</span>
                        </div>
                    </div>

                    <div class="search-box">
                        <div class="row g-3">
                            <!-- <div class="col-md-3">
                                <select class="form-select" id="categorySelect">
                                    <option value="æ°´æœ">æ°´æœ</option>
                                    <option value="è”¬èœ">è”¬èœ</option>
                                    <option value="è‚‰ç±»">è‚‰ç±»</option>
                                    <option value="æµ·é²œ">æµ·é²œ</option>
                                    <option value="è°·ç‰©">è°·ç‰©</option>
                                    <option value="ä¹³å“">ä¹³å“</option>
                                    <option value="ç”œå“">ç”œå“</option>
                                    <option value="çƒ˜ç„™ç±»">çƒ˜ç„™ç±»</option>
                                    <option value="é¥®æ–™">é¥®æ–™</option>
                                    <option value="å¿«é¤ç±»">å¿«é¤ç±»</option>
                                    <option value="æ±¤ç±»">æ±¤ç±»</option>
                                </select>
                            </div> -->
                            <div class="col-md-7">
                                <input type="text" class="form-control" id="foodInput" placeholder="è¾“å…¥é£Ÿå“åç§°">
                            </div>
                            <div class="col-md-2">
                                <button class="btn gradient-btn w-100" onclick="searchFood()">åˆ†æ</button>
                            </div>
                        </div>
                    </div>

                    <div id="chartContainer" class="chart-container" style="display: none;">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- è¥å…»æ’è¡Œ -->
            <div class="tab-pane fade" id="ranking">
                <div class="analysis-card p-4 my-4">
                    <h3 class="text-center mb-4">ğŸ† è¥å…»å«é‡æ’è¡Œæ¦œ</h3>

                    <div class="row g-3 mb-4 justify-content-center">
                        <div class="col-md-4">
                            <select class="form-select" id="nutrientSelect">
                                <option value="calories">å¡è·¯é‡Œ</option>
                                <option value="protein">è›‹ç™½è´¨</option>
                                <option value="fats">è„‚è‚ª</option>
                                <option value="carbs">ç¢³æ°´åŒ–åˆç‰©</option>
                                <option value="calcium">é’™</option>
                                <option value="fiber">çº¤ç»´</option>
                                <option value="starch">æ·€ç²‰</option>
                                <option value="iron">é“</option>
                                <option value="copper">é“œ</option>
                                <option value="magnesium">é•</option>
                                <option value="phosphorus">ç£·</option>
                                <option value="potassium">é’¾</option>
                                <option value="folate">å¶é…¸</option>
                                <option value="cholesterol">èƒ†å›ºé†‡</option>
                                <option value="vitamin_a_iu">ç»´ç”Ÿç´ A</option>
                                <option value="vitamin_c">ç»´ç”Ÿç´ C</option>
                                <option value="vitamin_d">ç»´ç”Ÿç´ D</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="typeSelect">
                                <option value="all">å…¨éƒ¨ç±»åˆ«</option>
                                <option value="æ°´æœ">æ°´æœ</option>
                                <option value="è”¬èœ">è”¬èœ</option>
                                <option value="æµ·é²œ">æµ·é²œ</option>
                                <option value="è‚‰ç±»">è‚‰ç±»</option>
                                <option value="ä¹³å“">ä¹³å“</option>
                                <option value="åšæœç±»">åšæœç±»</option>
                                <option value="æ±¤ç±»">æ±¤ç±»</option>
                                <option value="è°·ç‰©">è°·ç‰©</option>
                                <option value="ç”œå“">ç”œå“</option>
                                <option value="é¦™æ–™">é¦™æ–™</option>
                                <option value="é¥®æ–™">é¥®æ–™</option>
                                <option value="å¿«é¤ç±»">å¿«é¤ç±»</option>
                                <option value="æ²¹ç±»å’Œé…±ç±»">æ²¹ç±»å’Œé…±ç±»</option>
                                <option value="çƒ˜ç„™ç±»">çƒ˜ç„™ç±»</option>
                                <option value="é¤é¥®ã€ä¸»èœä»¥åŠé…èœ">é¤é¥®ã€ä¸»èœä»¥åŠé…èœ</option>

                            </select>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="rankingChart"
                        width="1400"
                        height="850"
                        position="relative"
                        top:100px
                        ></canvas>
                    </div>
                </div>
            </div>

            <!-- æ–°å¢åœ°å›¾ -->

            <div class="tab-pane fade" id="about">
            <div class="analysis-card p-4 my-4">
                <!-- <h3 class="text-center mb-4">å„åœ°é£Ÿç‰©äº§é‡å›¾</h3> -->
                    <div class="ditu">
                        <div class="button-container">
                            <button onclick="changeData('fruit')">æ°´æœ</button>
                            <button onclick="changeData('vegetable')">è”¬èœ</button>
                            <button onclick="changeData('meat')">è‚‰ç±»</button>
                            <button onclick="changeData('grain')">ç²®é£Ÿ</button>
                            <button onclick="changeData('seafood')">æµ·é²œ</button>
                            <button onclick="changeData('dairy')">å¥¶åˆ¶å“</button>
                        </div>
                        <div id="main">
                            <div class="description" id="dataDescription">
                                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>






                </div>
            </div>
            
        </div>
    </div>

    <script>
        Chart.defaults.color = '#ffffff';  // å…¨å±€é»˜è®¤æ–‡å­—é¢œè‰²
        let allFoods = [];
        let pieChart, rankingChart;

        // åˆå§‹åŒ–è·å–æ‰€æœ‰æ•°æ®
        const fetchAllFoods = async () => {
            try {
                const response = await fetch('http://localhost:8080/api/foods');
                if (!response.ok) throw new Error('æ•°æ®è·å–å¤±è´¥');
                const data = await response.json();
                allFoods = data;
                updateRanking();  // åˆå§‹åŒ–æ˜¾ç¤ºæ’è¡Œæ¦œ
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
            }
        };

        // è¥å…»åˆ†ææœç´¢åŠŸèƒ½
        const searchFood = async () => {
           // const category = document.getElementById('categorySelect').value;
            const foodName = document.getElementById('foodInput').value.trim();

            if (foodName) {
                try {
                    const response = await fetch(
                        `http://localhost:8080/getNutrients/food?name=${encodeURIComponent(foodName)}`
                    );

                    if (!response.ok) throw new Error('æœªæ‰¾åˆ°è¯¥é£Ÿå“');

                    const responseData = await response.json(); // è·å–åç«¯è¿”å›çš„ JSON æ•°æ®
                    const foodData = responseData.data; // æå– data å±æ€§ä¸­çš„å†…å®¹

                    document.getElementById('chartContainer').style.display = 'block';
                    updatePieChart(foodData);
                } catch (error) {
                    alert("âš ï¸ æœªæ‰¾åˆ°å¯¹åº”é£Ÿå“ï¼Œè¯·æ£€æŸ¥ï¼š\n1. é£Ÿå“åç§°æ˜¯å¦æ­£ç¡®\n2. ç±»åˆ«é€‰æ‹©æ˜¯å¦åŒ¹é…");
                }
            }
        };

        // æ›´æ–°é¥¼å›¾
        function updatePieChart(food) {
            if (pieChart) pieChart.destroy();

            const ctx = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['è›‹ç™½è´¨', 'è„‚è‚ª', 'ç¢³æ°´åŒ–åˆç‰©', 'çº¤ç»´'],
                    datasets: [{
                        data: [food.protein, food.fats, food.carbs, food.fiber],
                        backgroundColor: ['#4dc9f6', '#f67019', '#f53794', '#537bc4'],
                        borderWidth: 0
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: `${food.foodName} è¥å…»æˆåˆ†åˆ†å¸ƒ`,
                            font: { size: 18 }
                        }
                    }
                }
            });
        }

        // æ›´æ–°æ’è¡Œæ¦œ
        // function updateRanking() {
        //     const nutrient = document.getElementById('nutrientSelect').value;
        //     const type = document.getElementById('typeSelect').value;

        //     let filtered = allFoods;
        //     if (type !== 'all') filtered = filtered.filter(f => f.category === type);

        //     const sorted = filtered.sort((a, b) => b[nutrient] - a[nutrient]).slice(0, 10);

        //     if (rankingChart) rankingChart.destroy();

        //     const ctx = document.getElementById('rankingChart').getContext('2d');
        //     rankingChart = new Chart(ctx, {
        //         type: 'bar',
        //         data: {
        //             labels: sorted.map(f => f.name),
        //             datasets: [{
        //                 label: `${nutrient}å«é‡ (æ¯100å…‹)`,
        //                 data: sorted.map(f => f[nutrient]),
        //                 backgroundColor: '#37c2bb',
        //                 borderWidth: 0
        //             }]
        //         },
        //         options: {
        //             indexAxis: 'y',
        //             plugins: {
        //                 legend: { display: false },
        //                 title: {
        //                     display: true,
        //                     text: `${nutrient}å«é‡ TOP10 æ’è¡Œæ¦œ`,
        //                     font: { size: 18 }
        //                 }
        //             },
        //             scales: {
        //                 x: {
        //                     beginAtZero: true,
        //                     title: { display: true, text: 'å«é‡å€¼' }
        //                 }
        //             }
        //         }
        //     });
        // }


        // æ›´æ–°æ’è¡Œæ¦œ
        // function updateRanking() {
        //     const nutrient = document.getElementById('nutrientSelect').value;
        //     const type = document.getElementById('typeSelect').value;

        //     const url = `http://localhost:8080/getRanking?nutrient=${encodeURIComponent(nutrient)}&type=${encodeURIComponent(type)}`;

        //     fetch(url)
        //         .then(response => {
        //             if (!response.ok) throw new Error('è·å–æ’è¡Œæ¦œæ•°æ®å¤±è´¥');
        //             return response.json().data;
        //         })
        //         .then(data => {
        //             const sorted = data.slice(0, 10); // å‡è®¾åç«¯è¿”å›çš„æ•°æ®å·²ç»æ˜¯æ’åºå¥½çš„

        //             if (rankingChart) rankingChart.destroy();

        //             const ctx = document.getElementById('rankingChart').getContext('2d');
        //             rankingChart = new Chart(ctx, {
        //                 type: 'bar',
        //                 data: {
        //                     labels: sorted.map(f => f.name),
        //                     datasets: [{
        //                         label: `${nutrient}å«é‡ (æ¯100å…‹)`,
        //                         data: sorted.map(f => f[nutrient]),
        //                         backgroundColor: '#37c2bb',
        //                         borderWidth: 0
        //                     }]
        //                 },
        //                 options: {
        //                     indexAxis: 'y',
        //                     plugins: {
        //                         legend: { display: false },
        //                         title: {
        //                             display: true,
        //                             text: `${nutrient}å«é‡ TOP10 æ’è¡Œæ¦œ`,
        //                             font: { size: 18 }
        //                         }
        //                     },
        //                     scales: {
        //                         x: {
        //                             beginAtZero: true,
        //                             title: { display: true, text: 'å«é‡å€¼' }
        //                         }
        //                     }
        //                 }
        //             });
        //         })
        //         .catch(error => {
        //             console.error('æ›´æ–°æ’è¡Œæ¦œæ—¶å‡ºé”™:', error);
        //             alert("âš ï¸ è·å–æ’è¡Œæ¦œæ•°æ®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
        //         });
        // }
        // æ›´æ–°æ’è¡Œæ¦œ
        function updateRanking() {
            const nutrient = document.getElementById('nutrientSelect').value;
            const type = document.getElementById('typeSelect').value;

            const url = `http://localhost:8080/getRanking?nutrient=${encodeURIComponent(nutrient)}&type=${encodeURIComponent(type)}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('è·å–æ’è¡Œæ¦œæ•°æ®å¤±è´¥');
                    return response.json(); // è¿”å›è§£æåçš„ JSON æ•°æ®
                })
                .then(data => {
                    // æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
                    if (data.code !== 1) {
                        throw new Error(`åç«¯è¿”å›é”™è¯¯: ${data.msg}`);
                    }

                    // æå–å®é™…çš„æ•°æ®éƒ¨åˆ†
                    const foods = data.data;

                    // ç¡®ä¿æ•°æ®åŒ…å« nutrient å­—æ®µ
                    if (!foods || !Array.isArray(foods)) {
                        throw new Error('è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }

                    // æ ¹æ® nutrient å­—æ®µæ’åº
                    const sorted = foods.sort((a, b) => b[nutrient] - a[nutrient]).slice(0, 10);

                    if (rankingChart) rankingChart.destroy();

                    const ctx = document.getElementById('rankingChart').getContext('2d');
                    rankingChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: sorted.map(f => f.foodName), // ä½¿ç”¨ foodName å­—æ®µ
                            datasets: [{
                                label: `${nutrient}å«é‡ (æ¯100å…‹)`,
                                data: sorted.map(f => f[nutrient]),
                                backgroundColor: '#37c2bb',
                                borderWidth: 0,
                               
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: `${nutrient}å«é‡ TOP10 æ’è¡Œæ¦œ`,
                                    font: { size: 18,
                                             
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'å«é‡å€¼' }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('æ›´æ–°æ’è¡Œæ¦œæ—¶å‡ºé”™:', error);
                    alert("âš ï¸ è·å–æ’è¡Œæ¦œæ•°æ®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
                });
        }



        // åˆå§‹åŒ–
        document.getElementById('nutrientSelect').addEventListener('change', updateRanking);
        document.getElementById('typeSelect').addEventListener('change', updateRanking);
        // document.getElementById('foodInput').addEventListener('input', searchFood);
        fetchAllFoods();

        // åˆ‡æ¢æ ‡ç­¾æ—¶é‡ç½®å›¾è¡¨å°ºå¯¸
        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
            tab.addEventListener('shown.bs.tab', () => {
                if (pieChart) pieChart.resize();
                if (rankingChart) rankingChart.resize();
            });
        });
    </script>




<!-- åœ°å›¾js -->


<script type="text/javascript">
    // æ•°æ®
    var data = {
        fruit: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 38.33 },
            { name: 'å¤©æ´¥', value: 57.85 },
            { name: 'ä¸Šæµ·', value: 31.92 },
            { name: 'é‡åº†', value: 593.28 },
            { name: 'æ²³åŒ—', value: 1533.87 },
            { name: 'æ²³å—', value: 2542.03 },
            { name: 'äº‘å—', value: 1298.05 },
            { name: 'è¾½å®', value: 879.66 },
            { name: 'é»‘é¾™æ±Ÿ', value: 189.43 },
            { name: 'æ¹–å—', value: 1208.17 },
            { name: 'å®‰å¾½', value: 798.35 },
            { name: 'å±±ä¸œ', value: 3095.51 },
            { name: 'æ–°ç–†', value: 1672.61 },
            { name: 'æ±Ÿè‹', value: 1002.13 },
            { name: 'æµ™æ±Ÿ', value: 704.49 },
            { name: 'æ±Ÿè¥¿', value: 749.38 },
            { name: 'æ¹–åŒ—', value: 1143.24 },
            { name: 'å¹¿è¥¿', value: 3402.46 },
            { name: 'ç”˜è‚ƒ', value: 965.46 },
            { name: 'å±±è¥¿', value: 1002.77 },
            { name: 'å†…è’™å¤', value: 175.54 },
            { name: 'é™•è¥¿', value: 2240.78 },
            { name: 'å‰æ—', value: 166.02 },
            { name: 'ç¦å»º', value: 864.94 },
            { name: 'è´µå·', value: 698.87 },
            { name: 'å¹¿ä¸œ', value: 2028.38 },
            { name: 'é’æµ·', value: 2.77 },
            { name: 'è¥¿è—', value: 3.14 },
            { name: 'å››å·', value: 1380.5 },
            { name: 'å®å¤', value: 271.73 },
            { name: 'æµ·å—', value: 563.57 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ],
        meat: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 4.33 },
            { name: 'å¤©æ´¥', value: 29.5 },
            { name: 'ä¸Šæµ·', value: 9.54 },
            { name: 'é‡åº†', value: 205.27 },
            { name: 'æ²³åŒ—', value: 478.83 },
            { name: 'æ²³å—', value: 660.04 },
            { name: 'äº‘å—', value: 521.6 },
            { name: 'è¾½å®', value: 446.21 },
            { name: 'é»‘é¾™æ±Ÿ', value: 312.53 },
            { name: 'æ¹–å—', value: 580.86 },
            { name: 'å®‰å¾½', value: 475.34 },
            { name: 'å±±ä¸œ', value: 844.51 },
            { name: 'æ–°ç–†', value: 204.69 },
            { name: 'æ±Ÿè‹', value: 318.06 },
            { name: 'æµ™æ±Ÿ', value: 108.49 },
            { name: 'æ±Ÿè¥¿', value: 359.9 },
            { name: 'æ¹–åŒ—', value: 441.16 },
            { name: 'å¹¿è¥¿', value: 454.94 },
            { name: 'ç”˜è‚ƒ', value: 142.65 },
            { name: 'å±±è¥¿', value: 143.2 },
            { name: 'å†…è’™å¤', value: 284.05 },
            { name: 'é™•è¥¿', value: 132.09 },
            { name: 'å‰æ—', value: 291.04 },
            { name: 'ç¦å»º', value: 296.3 },
            { name: 'è´µå·', value: 241.03 },
            { name: 'å¹¿ä¸œ', value: 481.01 },
            { name: 'é’æµ·', value: 40.98 },
            { name: 'è¥¿è—', value: 28.63 },
            { name: 'å››å·', value: 685.72 },
            { name: 'å®å¤', value: 36.77 },
            { name: 'æµ·å—', value: 69.2 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ],
        grain: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 57.6 },
            { name: 'å¤©æ´¥', value: 270.6 },
            { name: 'ä¸Šæµ·', value: 98.3 },
            { name: 'é‡åº†', value: 1100.7 },
            { name: 'æ²³åŒ—', value: 3908.8 },
            { name: 'æ²³å—', value: 6719.4 },
            { name: 'äº‘å—', value: 1993.5 },
            { name: 'è¾½å®', value: 2500.3 },
            { name: 'é»‘é¾™æ±Ÿ', value: 8001.7 },
            { name: 'æ¹–å—', value: 3078.1 },
            { name: 'å®‰å¾½', value: 4184.3 },
            { name: 'å±±ä¸œ', value: 5710.2 },
            { name: 'æ–°ç–†', value: 2330.2 },
            { name: 'æ±Ÿè‹', value: 3810.1 },
            { name: 'æµ™æ±Ÿ', value: 650.2 },
            { name: 'æ±Ÿè¥¿', value: 2196.0 },
            { name: 'æ¹–åŒ—', value: 2785.3 },
            { name: 'å¹¿è¥¿', value: 1403.8 },
            { name: 'ç”˜è‚ƒ', value: 1296.1 },
            { name: 'å±±è¥¿', value: 1468.7 },
            { name: 'å†…è’™å¤', value: 4100.5 },
            { name: 'é™•è¥¿', value: 1352.3 },
            { name: 'å‰æ—', value: 4266.0 },
            { name: 'ç¦å»º', value: 514.4 },
            { name: 'è´µå·', value: 1146.1 },
            { name: 'å¹¿ä¸œ', value: 1313.4 },
            { name: 'é’æµ·', value: 118.3 },
            { name: 'è¥¿è—', value: 112.9 },
            { name: 'å››å·', value: 3633.8 },
            { name: 'å®å¤', value: 385.9 },
            { name: 'æµ·å—', value: 142.4 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ],
        seafood: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 4252 },
            { name: 'å¤©æ´¥', value: 41033 },
            { name: 'ä¸Šæµ·', value: 138058 },
            { name: 'é‡åº†', value: 0 },
            { name: 'æ²³åŒ—', value: 813209 },
            { name: 'æ²³å—', value: 0 },
            { name: 'äº‘å—', value: 0 },
            { name: 'è¾½å®', value: 4027168 },
            { name: 'é»‘é¾™æ±Ÿ', value: 0 },
            { name: 'æ¹–å—', value: 0 },
            { name: 'å®‰å¾½', value: 0 },
            { name: 'å±±ä¸œ', value: 7622454 },
            { name: 'æ–°ç–†', value: 0 },
            { name: 'æ±Ÿè‹', value: 1352220 },
            { name: 'æµ™æ±Ÿ', value: 4754098 },
            { name: 'æ±Ÿè¥¿', value: 0 },
            { name: 'æ¹–åŒ—', value: 0 },
            { name: 'å¹¿è¥¿', value: 2151841 },
            { name: 'ç”˜è‚ƒ', value: 0 },
            { name: 'å±±è¥¿', value: 0 },
            { name: 'å†…è’™å¤', value: 0 },
            { name: 'é™•è¥¿', value: 0 },
            { name: 'å‰æ—', value: 0 },
            { name: 'ç¦å»º', value: 7624395 },
            { name: 'è´µå·', value: 0 },
            { name: 'å¹¿ä¸œ', value: 4582874 },
            { name: 'é’æµ·', value: 0 },
            { name: 'è¥¿è—', value: 0 },
            { name: 'å››å·', value: 0 },
            { name: 'å®å¤', value: 0 },
            { name: 'æµ·å—', value: 1280529 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ],
        dairy: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 26.22 },
            { name: 'å¤©æ´¥', value: 51.13 },
            { name: 'ä¸Šæµ·', value: 30.22 },
            { name: 'é‡åº†', value: 3.19 },
            { name: 'æ²³åŒ—', value: 549.31 },
            { name: 'æ²³å—', value: 217.80 },
            { name: 'äº‘å—', value: 70.22 },
            { name: 'è¾½å®', value: 135.12 },
            { name: 'é»‘é¾™æ±Ÿ', value: 501.87 },
            { name: 'æ¹–å—', value: 7.20 },
            { name: 'å®‰å¾½', value: 50.74 },
            { name: 'å±±ä¸œ', value: 304.49 },
            { name: 'æ–°ç–†', value: 231.46 },
            { name: 'æ±Ÿè‹', value: 68.78 },
            { name: 'æµ™æ±Ÿ', value: 79.65 },
            { name: 'æ±Ÿè¥¿', value: 7.92 },
            { name: 'æ¹–åŒ—', value: 9.18 },
            { name: 'å¹¿è¥¿', value: 13.12 },
            { name: 'ç”˜è‚ƒ', value: 92.67 },
            { name: 'å±±è¥¿', value: 143.14 },
            { name: 'å†…è’™å¤', value: 740.85 },
            { name: 'é™•è¥¿', value: 170.46 },
            { name: 'å‰æ—', value: 29.37 },
            { name: 'ç¦å»º', value: 22.05 },
            { name: 'è´µå·', value: 3.73 },
            { name: 'å¹¿ä¸œ', value: 19.89 },
            { name: 'é’æµ·', value: 35.30 },
            { name: 'è¥¿è—', value: 57.79 },
            { name: 'å››å·', value: 70.83 },
            { name: 'å®å¤', value: 342.50 },
            { name: 'æµ·å—', value: 0.28 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ],
        vegetable: [
            { name: "å—æµ·è¯¸å²›", value: 0 },
            { name: 'åŒ—äº¬', value: 207.48 },
            { name: 'å¤©æ´¥', value: 253.75 },
            { name: 'ä¸Šæµ·', value: 254.78 },
            { name: 'é‡åº†', value: 2362.01 },
            { name: 'æ²³åŒ—', value: 5498.04 },
            { name: 'æ²³å—', value: 8045.56 },
            { name: 'äº‘å—', value: 2960.83 },
            { name: 'è¾½å®', value: 2139.68 },
            { name: 'é»‘é¾™æ±Ÿ', value: 870.47 },
            { name: 'æ¹–å—', value: 4488.81 },
            { name: 'å®‰å¾½', value: 2630.14 },
            { name: 'å±±ä¸œ', value: 9272.41 },
            { name: 'æ–°ç–†', value: 2074.23 },
            { name: 'æ±Ÿè‹', value: 6135.61 },
            { name: 'æµ™æ±Ÿ', value: 1992.51 },
            { name: 'æ±Ÿè¥¿', value: 1860.88 },
            { name: 'æ¹–åŒ—', value: 4502.71 },
            { name: 'å¹¿è¥¿', value: 4425.03 },
            { name: 'ç”˜è‚ƒ', value: 1822.65 },
            { name: 'å±±è¥¿', value: 1065.88 },
            { name: 'å†…è’™å¤', value: 1097.14 },
            { name: 'é™•è¥¿', value: 2151.2 },
            { name: 'å‰æ—', value: 540.05 },
            { name: 'ç¦å»º', value: 1804.78 },
            { name: 'è´µå·', value: 3469.97 },
            { name: 'å¹¿ä¸œ', value: 4099.33 },
            { name: 'é’æµ·', value: 158.49 },
            { name: 'è¥¿è—', value: 88.39 },
            { name: 'å››å·', value: 5417.87 },
            { name: 'å®å¤', value: 544.54 },
            { name: 'æµ·å—', value: 632.9 },
            { name: 'å°æ¹¾', value: 0 },
            { name: 'é¦™æ¸¯', value: 0 },
            { name: 'æ¾³é—¨', value: 0 }
        ]

    };

    // åˆå§‹åŒ–å›¾å½¢åŒºåŸŸ
    var myChart = echarts.init(document.getElementById('main'));

    // é»˜è®¤æ•°æ®
    var currentData = data.fruit;
    var currentTitle = 'æ°´æœå¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';

    // ç›¸å…³å±æ€§
    var option = {
        tooltip: {
            formatter: function (params, ticket, callback) {
                return params.seriesName + '<br/>' + params.name + 'ï¼š' + params.value;
            } // æ•°æ®æ ¼å¼åŒ–
        },
        visualMap: {
            min: 0,
            max: 1500,
            left: 'left',
            top: 'bottom',
            text: ['å¤š', 'å°‘'], // å–å€¼èŒƒå›´çš„æ–‡å­—
            inRange: {
                // color: ['#289A48', '#E63F31'] // å–å€¼èŒƒå›´çš„é¢œè‰²
                // color: ['#289A48', '#55C16A', '#82E48C', '#B0F7AF', '#E63F31', '#E66A31', '#E69531']
                //  color: [
                //     '#36C053',  // è§å…‰ç»¿ï¼ˆä½œä¸ºèµ·ç‚¹äº®è‰²ï¼‰
                //     '#8AFF99',  // è–„è·ç»¿
                //     '#D1FF59',  // è§å…‰é»„ç»¿
                //     '#FFEA00',  // æ˜é»„è‰²ï¼ˆä¸­é—´å¯¹æ¯”è‰²ï¼‰
                //     '#FF9966',  // çŠç‘šæ©™
                //     '#FF6B6B',  // äº®çŠç‘šçº¢
                //     '#FF3B3B'   // è§å…‰çº¢ï¼ˆä½œä¸ºç»ˆç‚¹äº®è‰²ï¼‰
                // ]
                color: [
                    '#00FFE0',  // ç”µå­é’ï¼ˆå†·è‰²èµ·ç‚¹ï¼‰
                    '#7BFF73',  // è§å…‰ç»¿
                    '#C8FF4D',  // æ¿€å…‰é»„
                    '#FF2B7E',  // éœ“è™¹ç²‰ï¼ˆè§†è§‰ç„¦ç‚¹ï¼‰
                    '#FF00FF',  // å“çº¢è‰²
                    '#A020F0',  // ç”µå…‰ç´«
                    '#4B0082'   // æ·±é›è“ï¼ˆå†·è‰²ç»ˆç‚¹ï¼‰
                ]
            },
            show: true // å›¾æ³¨
        },
        geo: {
            map: 'china',
            roam: false, // ä¸å¼€å¯ç¼©æ”¾å’Œå¹³ç§»
            zoom: 1.23, // è§†è§’ç¼©æ”¾æ¯”ä¾‹
            label: {
                normal: {
                    show: true,
                    fontSize: '10',
                    color: 'rgba(0,0,0,0.7)'
                }
            },
            itemStyle: {
                normal: {
                    borderColor: 'rgba(0, 0, 0, 0.2)'
                },
                emphasis: {
                    areaColor: '#F3B329', // é¼ æ ‡é€‰æ‹©åŒºåŸŸé¢œè‰²
                    shadowOffsetX: 0,
                    shadowOffsetY: 0,
                    shadowBlur: 20,
                    borderWidth: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        },
        series: [{
            name: currentTitle,
            type: 'map',
            geoIndex: 0,
            data: currentData
        }]
    };

    myChart.setOption(option);

    // ç‚¹å‡»äº‹ä»¶ç›‘å¬
    myChart.on('click', function (params) {
        alert(params.name + " " + currentTitle + "ä¸ºï¼š" + params.value + "ä¸‡å¨");
    });

    // åˆ‡æ¢æ•°æ®å‡½æ•°
    function changeData(type) {
        currentData = data[type];
        switch (type) {
            case 'fruit':
                currentTitle = 'æ°´æœå¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';
                break;
            case 'vegetable':
                currentTitle = 'è”¬èœå¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';
                break;

            case 'meat':
                currentTitle = 'è‚‰ç±»å¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';
                break;
            case 'grain':
                currentTitle = 'ç²®é£Ÿå¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';
                break;
            case 'seafood':
                currentTitle = 'æµ·é²œå¹´äº§é‡ï¼ˆå¨ï¼‰';
                break;
            case 'dairy':
                currentTitle = 'ä¹³åˆ¶å“å¹´äº§é‡ï¼ˆä¸‡å¨ï¼‰';
                break;
        }
        option.series[0].data = currentData;
        option.series[0].name = currentTitle;
        option.visualMap.max = Math.max(...currentData.map(item => item.value));
        myChart.setOption(option);
        document.getElementById('title').innerText = 'ä¸­å›½å„åœ°' + currentTitle;
    }





</script>



<!-- åœ°å›¾jsæˆªæ­¢ -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>